<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/src/assets/image1.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Virtual Assistant</title>
    
    <!-- IMPROVED ERROR HANDLER -->
    <script>
      (function() {
        console.log('ðŸ”§ Initializing improved error handler...');
        
        // Store original console methods
        const originalError = console.error;
        const originalWarn = console.warn;
        
        // Improved error filtering
        console.error = function(...args) {
          const message = args[0] ? String(args[0]) : '';
          
          // Filter out common noise errors
          const silentErrors = [
            '401', 'Unauthorized', 'Failed to fetch',
            'Network Error', 'ERR_NETWORK',
            'session', 'auth', 'login',
            '/api/user/current', '/api/auth/',
            'TypeError', 't is not a function',
            'speech', 'microphone', 'Recognition'
          ];
          
          const shouldSilence = silentErrors.some(keyword => 
            message.includes(keyword)
          );
          
          if (shouldSilence) {
            // Log silently for debugging
            if (message.includes('401') && message.includes('/api/')) {
              console.log('[Auth] Silent 401 - Normal for unauthenticated users');
            }
            return;
          }
          
          originalError.apply(console, args);
        };
        
        console.warn = function(...args) {
          const message = args[0] ? String(args[0]) : '';
          
          // Filter out common warnings
          if (message.includes('React') || 
              message.includes('deprecated') ||
              message.includes('experimental')) {
            return;
          }
          
          originalWarn.apply(console, args);
        };
        
        // Handle fetch errors gracefully
        const originalFetch = window.fetch;
        window.fetch = async function(...args) {
          try {
            const response = await originalFetch.apply(this, args);
            
            // Don't log 401 errors for auth endpoints
            if (response.status === 401) {
              const url = args[0] || '';
              if (typeof url === 'string' && url.includes('/api/')) {
                return response; // Let the app handle it
              }
            }
            
            return response;
          } catch (error) {
            // Network errors - don't spam console
            if (error.name === 'TypeError' && error.message.includes('fetch')) {
              console.log('[Network] Connection issue');
              throw error; // Re-throw for app to handle
            }
            throw error;
          }
        };
        
        console.log('âœ… Error handler active - Common errors filtered');
        
        // Add global error listener for uncaught errors
        window.addEventListener('error', function(event) {
          // Don't stop propagation, just log quietly
          if (event.error && event.error.message) {
            const msg = event.error.message;
            if (msg.includes('401') || msg.includes('auth') || msg.includes('session')) {
              event.preventDefault();
              return false;
            }
          }
        });
        
        // Handle unhandled promise rejections
        window.addEventListener('unhandledrejection', function(event) {
          const reason = event.reason;
          if (reason && 
              (reason.status === 401 || 
               reason.message?.includes('auth') || 
               reason.message?.includes('401'))) {
            event.preventDefault();
            console.log('[Promise] Silent auth rejection');
          }
        });
      })();
    </script>
    
    <!-- BASIC STYLES -->
    <style>
      * { 
        margin: 0; 
        padding: 0; 
        box-sizing: border-box; 
      }
      
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
          'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
          sans-serif;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        background: #0a0a0a;
        color: white;
        overflow-x: hidden;
        min-height: 100vh;
      }
      
      /* Loading animation */
      @keyframes pulse {
        0%, 100% { opacity: 0.5; }
        50% { opacity: 1; }
      }
      
      .loading-pulse {
        animation: pulse 2s ease-in-out infinite;
      }
      
      /* Scrollbar styling */
      ::-webkit-scrollbar {
        width: 8px;
      }
      
      ::-webkit-scrollbar-track {
        background: #1a1a1a;
      }
      
      ::-webkit-scrollbar-thumb {
        background: #3b82f6;
        border-radius: 4px;
      }
      
      ::-webkit-scrollbar-thumb:hover {
        background: #2563eb;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
